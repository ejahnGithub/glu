//
// RUN: gluc %s -o %t && %t | FileCheck -v %s
//

@no_mangling func putchar(c: Char);
@no_mangling func puts(c: *Char);

@no_mangling func malloc(memorySize: Int) -> *Char;

func .*(nil: Null) -> Char {
    puts("don't dereference null!");
    return "B";
}

func main() -> Int {
    let ptr = malloc(1);
    ptr.* = "A";
    ptr[1] = "M";

    // CHECK: A
    putchar(ptr.*);
    puts("");
    // CHECK-NEXT: don't dereference null!
    // CHECK-NEXT: B
    putchar(null.*);
    puts("");
    // CHECK-NEXT: M
    putchar(ptr[1]);
    puts("");
    return 0;
}
